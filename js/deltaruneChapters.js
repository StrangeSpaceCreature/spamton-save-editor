


var exportLinesCh1Demo = [
    1, 2, 8, 9, 10, 11, 16,
    71, 72, 73, 74, 75, 77, 78, 79, 113, 114, 115, 116, 117, 118,
    125, 126, 127, 128, 129, 131, 132, 133, 167, 168, 169, 170, 171, 172,
    179, 180, 181, 182, 183, 185, 186, 187, 221, 222, 223, 224, 225, 226,
    236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261,
    262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287,
    290, 291, 292, 293, 294, 295, 296, 297, 298,
    301, 303, 305, 307, 309, 311, 313, 315,
    302, 304, 306, 308, 310, 312, 314, 316,
    423,
    572, 573, 574, 575, 576, 577, 578, 579, 582, 586, 587, 588, 589, 590, 591, 592, 593, 594,
    537, 538, 539, 540, 541, 542, 524,
    1217, 1218, 1219, 1220, 1221, 1222, 1223, 1224, 1225, 1226,
    558, 571, 1228, 569, 570,
    10316, 10317, 10318
]

var exportLinesCh2Demo = [
    1, 2, 8, 9, 10, 11, 16,
    79, 80, 81, 82, 83, 85, 86, 87, 129, 130, 131, 132, 133, 134,
    141, 142, 143, 144, 145, 147, 148, 149, 191, 192, 193, 194, 195, 196,
    203, 204, 205, 206, 207, 209, 210, 211, 253, 254, 255, 256, 257, 258,
    265, 266, 267, 268, 269, 271, 272, 273, 315, 316, 317, 318, 319, 320,
    318,
    330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353,
    356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379,
    380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403,
    404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427,
    428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451,
    452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475,
    526, 527, 528, 529, 530, 531, 532, 533, 534,
    537, 539, 541, 543, 545, 547, 549, 551,
    538, 540, 542, 544, 546, 548, 550, 552,
    587, 659,
    773, 774, 775, 776, 777, 778, 760,
    808, 809, 810, 811, 812, 813, 814, 815, 818, 822, 823, 824, 825, 826, 827, 828, 829, 830,
    794, 805, 806, 807, 878,
    890, 975, 1014, 861, 868, 869, 870, 894, 933, 978, 977, 855, 895, 983, 992,
    862, 1015, 1010, 910,
    1153, 1154, 1155, 1156, 1157, 1158, 1159, 1160, 1161, 1162, 1163, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171,
    1172, 1173, 1174, 1175, 1176, 1177, 1178, 1179, 1180, 1181, 1182, 1183, 1184, 1185, 1186, 1187, 1188, 1189, 1190,
    1191, 1192, 1193, 1194, 1195, 1196, 1197, 1198, 1199, 1200, 1201, 1202,
    1453, 1454, 1455, 1456, 1457, 1458, 1459, 1460, 1461, 1462, 1464, 1471,
    1353, 1354, 1355, 1356,
    1468, 1473, 1474, 1475, 1478, 3053, 3054, 3055
]

var exportLinesCh1 = [
    1, 2, 8, 9, 10, 11, 16,
    71, 72, 73, 74, 75, 77, 78, 79, 113, 114, 115, 116, 117, 118,
    125, 126, 127, 128, 129, 131, 132, 133, 167, 168, 169, 170, 171, 172,
    179, 180, 181, 182, 183, 185, 186, 187, 221, 222, 223, 224, 225, 226,
    236, 237, 238, 239, 240, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250, 251, 252, 253, 254, 255, 256, 257, 258, 259, 260, 261,
    262, 263, 264, 265, 266, 267, 268, 269, 270, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 281, 282, 283, 284, 285, 286, 287,
    290, 291, 292, 293, 294, 295, 296, 297, 298,
    301, 303, 305, 307, 309, 311, 313, 315,
    302, 304, 306, 308, 310, 312, 314, 316,
    423,
    572, 573, 574, 575, 576, 577, 578, 579, 582, 586, 587, 588, 589, 590, 591, 592, 593, 594,
    537, 538, 539, 540, 541, 542, 524,
    1217, 1218, 1219, 1220, 1221, 1222, 1223, 1224, 1225, 1226,
    558, 571, 1228, 569, 570,
    10316, 10317, 10318
]

var exportLinesCh2 = [
    1, 2, 8, 9, 10, 11, 16,
    79, 80, 81, 82, 83, 85, 86, 87, 129, 130, 131, 132, 133, 134,
    141, 142, 143, 144, 145, 147, 148, 149, 191, 192, 193, 194, 195, 196,
    203, 204, 205, 206, 207, 209, 210, 211, 253, 254, 255, 256, 257, 258,
    265, 266, 267, 268, 269, 271, 272, 273, 315, 316, 317, 318, 319, 320,
    318,
    330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353,
    356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379,
    380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403,
    404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427,
    428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451,
    452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475,
    526, 527, 528, 529, 530, 531, 532, 533, 534,
    537, 539, 541, 543, 545, 547, 549, 551,
    538, 540, 542, 544, 546, 548, 550, 552,
    587, 659,
    773, 774, 775, 776, 777, 778, 760,
    808, 809, 810, 811, 812, 813, 814, 815, 818, 822, 823, 824, 825, 826, 827, 828, 829, 830,
    794, 805, 806, 807, 878,
    890, 975, 1014, 861, 868, 869, 870, 894, 933, 978, 977, 855, 895, 983, 992,
    862, 1015, 1010, 910,
    1153, 1154, 1155, 1156, 1157, 1158, 1159, 1160, 1161, 1162, 1163, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171,
    1172, 1173, 1174, 1175, 1176, 1177, 1178, 1179, 1180, 1181, 1182, 1183, 1184, 1185, 1186, 1187, 1188, 1189, 1190,
    1191, 1192, 1193, 1194, 1195, 1196, 1197, 1198, 1199, 1200, 1201, 1202,
    1453, 1454, 1455, 1456, 1457, 1458, 1459, 1460, 1461, 1462, 1464, 1471,
    1353, 1354, 1355, 1356,
    1468, 1473, 1474, 1475, 1478, 3053, 3054, 3055
]

var exportLinesCh3 = [
    1, 2, 8, 9, 10, 11, 16,
    79, 80, 81, 82, 83, 85, 86, 87, 129, 130, 131, 132, 133, 134,
    141, 142, 143, 144, 145, 147, 148, 149, 191, 192, 193, 194, 195, 196,
    203, 204, 205, 206, 207, 209, 210, 211, 253, 254, 255, 256, 257, 258,
    265, 266, 267, 268, 269, 271, 272, 273, 315, 316, 317, 318, 319, 320,
    318,
    330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353,
    356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379,
    380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403,
    404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427,
    428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451,
    452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475,
    526, 527, 528, 529, 530, 531, 532, 533, 534,
    537, 539, 541, 543, 545, 547, 549, 551,
    538, 540, 542, 544, 546, 548, 550, 552,
    587, 659,
    773, 774, 775, 776, 777, 778, 760,
    808, 809, 810, 811, 812, 813, 814, 815, 818, 822, 823, 824, 825, 826, 827, 828, 829, 830,
    794, 805, 806, 807, 878,
    890, 975, 1014, 861, 868, 869, 870, 894, 933, 978, 977, 855, 895, 983, 992,
    862, 1015, 1010, 910,
    1153, 1154, 1155, 1156, 1157, 1158, 1159, 1160, 1161, 1162, 1163, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171,
    1172, 1173, 1174, 1175, 1176, 1177, 1178, 1179, 1180, 1181, 1182, 1183, 1184, 1185, 1186, 1187, 1188, 1189, 1190,
    1191, 1192, 1193, 1194, 1195, 1196, 1197, 1198, 1199, 1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209,
    1210, 1211, 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223, 1224, 1225, 1226, 1227, 1228,
    1229, 1330, 1331, 1332,
    1453, 1454, 1455, 1456, 1457, 1458, 1459, 1460, 1461, 1462, 1464, 1471,
    1353, 1354, 1355, 1356,
    1597,
    1468, 1473, 1474, 1475, 1478, 3053, 3054, 3055
]

var exportLinesCh4 = [
    1, 2, 8, 9, 10, 11, 16,
    79, 80, 81, 82, 83, 85, 86, 87, 129, 130, 131, 132, 133, 134,
    141, 142, 143, 144, 145, 147, 148, 149, 191, 192, 193, 194, 195, 196,
    203, 204, 205, 206, 207, 209, 210, 211, 253, 254, 255, 256, 257, 258,
    265, 266, 267, 268, 269, 271, 272, 273, 315, 316, 317, 318, 319, 320,
    318,
    330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353,
    356, 357, 358, 359, 360, 361, 362, 363, 364, 365, 366, 367, 368, 369, 370, 371, 372, 373, 374, 375, 376, 377, 378, 379,
    380, 381, 382, 383, 384, 385, 386, 387, 388, 389, 390, 391, 392, 393, 394, 395, 396, 397, 398, 399, 400, 401, 402, 403,
    404, 405, 406, 407, 408, 409, 410, 411, 412, 413, 414, 415, 416, 417, 418, 419, 420, 421, 422, 423, 424, 425, 426, 427,
    428, 429, 430, 431, 432, 433, 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451,
    452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 471, 472, 473, 474, 475,
    526, 527, 528, 529, 530, 531, 532, 533, 534,
    537, 539, 541, 543, 545, 547, 549, 551,
    538, 540, 542, 544, 546, 548, 550, 552,
    587, 659,
    773, 774, 775, 776, 777, 778, 760,
    808, 809, 810, 811, 812, 813, 814, 815, 818, 822, 823, 824, 825, 826, 827, 828, 829, 830,
    794, 805, 806, 807, 878,
    890, 975, 1014, 861, 868, 869, 870, 894, 933, 978, 977, 855, 895, 983, 992,
    862, 1015, 1010, 910,
    1153, 1154, 1155, 1156, 1157, 1158, 1159, 1160, 1161, 1162, 1163, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171,
    1172, 1173, 1174, 1175, 1176, 1177, 1178, 1179, 1180, 1181, 1182, 1183, 1184, 1185, 1186, 1187, 1188, 1189, 1190,
    1191, 1192, 1193, 1194, 1195, 1196, 1197, 1198, 1199, 1200, 1201, 1202, 1203, 1204, 1205, 1206, 1207, 1208, 1209,
    1210, 1211, 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223, 1224, 1225, 1226, 1227, 1228,
    1229, 1330, 1331, 1332,
    1453, 1454, 1455, 1456, 1457, 1458, 1459, 1460, 1461, 1462, 1464, 1471,
    1353, 1354, 1355, 1356,
    1468, 1473, 1474, 1475, 1478, 3053, 3054, 3055
]


var chaptersConfig = {
    ch1Demo: {
        displayName: 'Chapter 1 Demo',
        length: 10318,
        exportLines: exportLinesCh1Demo,
        thrash: [540, 541, 542],
        gonerIndices: [1217, 1218, 1219],
        thrashOptions: ['_537', '_538', '_539', '_540', '_541', '_542'],
        tabs: ['main', 'party', 'items', 'creations', 'hometown', 'other', 'all']
    },
    ch1: {
        displayName: 'Chapter 1',
        length: 10318,
        exportLines: exportLinesCh1,
        thrash: [540, 541, 542],
        gonerIndices: [1217, 1218, 1219],
        thrashOptions: ['_537', '_538', '_539', '_540', '_541', '_542'],
        tabs: ['main', 'party', 'items', 'creations', 'hometown', 'other', 'all']
    },
    ch2Demo: {
        displayName: 'Chapter 2 Demo',
        length: 3055,
        exportLines: exportLinesCh2Demo,
        thrash: [776, 777, 778],
        gonerIndices: [1453, 1454, 1455],
        thrashOptions: ['_773', '_774', '_775', '_776', '_777', '_778'],
        tabs: ['main', 'party', 'items', 'recruits', 'hometown', 'chapter1', 'other', 'all']
    },
    ch2: {
        displayName: 'Chapter 2',
        length: 3055,
        exportLines: exportLinesCh2,
        thrash: [776, 777, 778],
        gonerIndices: [1453, 1454, 1455],
        thrashOptions: ['_773', '_774', '_775', '_776', '_777', '_778'],
        tabs: ['main', 'party', 'items', 'recruits', 'hometown', 'chapter1', 'other', 'all']
    },
    ch3: {
        displayName: 'Chapter 3',
        length: 3055,
        exportLines: exportLinesCh3,
        thrash: [776, 777, 778],
        gonerIndices: [1453, 1454, 1455],
        thrashOptions: ['_773', '_774', '_775', '_776', '_777', '_778'],
        tabs: ['main', 'party', 'items', 'recruits', 'hometown', 'chapter1', 'chapter2', 'all']
    },
    ch4: {
        displayName: 'Chapter 4',
        length: 3055,
        exportLines: exportLinesCh4,
        thrash: [776, 777, 778],
        gonerIndices: [1453, 1454, 1455],
        thrashOptions: ['_773', '_774', '_775', '_776', '_777', '_778'],
        tabs: ['main', 'party', 'items', 'recruits', 'hometown', 'chapter1', 'chapter2', 'all']
    }
};

function saveToJson(chKey, text) {
    var cfg = chaptersConfig[chKey];
    var clean = text.replace(/[^a-zA-Z0-9ぁ-んァ-ン_ .\r\n-]/g, '');
    var lines = clean.split('\r\n');
    if (lines.length !== cfg.length) {
        return { err: `Invalid length: ${lines.length}` };
    }
    var out = {};
    cfg.exportLines.forEach(n => {
        out['_' + n] = lines[n - 1].trim();
    });
    return out;
}